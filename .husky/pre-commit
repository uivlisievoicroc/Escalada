#!/bin/sh
# Husky pre-commit hook: run Prettier via lint-staged (frontend) and pre-commit (backend)

# Format staged frontend files
cd Escalada/escalada-ui || exit 1
npx lint-staged || exit 1

# Run Python pre-commit hooks on staged Python files
cd ../ || exit 1
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM | tr '\n' ' ')
if [ -n "$STAGED_FILES" ]; then
	# Only pass files inside Escalada/escalada
	FILTERED_FILES=$(echo "$STAGED_FILES" | tr ' ' '\n' | grep '^Escalada/escalada/.*\.py$' | tr '\n' ' ')
	if [ -n "$FILTERED_FILES" ]; then
		echo "Running pre-commit on: $FILTERED_FILES"
		(cd Escalada && poetry run pre-commit run --files $FILTERED_FILES) || exit 1
	fi
fi
